const KMD_INSTANCES={};window.KMDHook=class KMDHook{constructor(t,e){KMD_INSTANCES[t]=Object.freeze({type:t,processor:e})}}window.KMDApi=class t{KMD_BUILD="0.1";KMD_SCRIPT_URL="";KMD_SCRIPT="";KMD_HOOKS=[];KMD_LOCK=[];StopLoad(){window.stop(),fetch(location.href).then(function t(e){let o=e.replaceAll(this.KMD_SCRIPT_URL,"");document.write(o)})}SetScript(t){this.KMD_SCRIPT_URL=t}ExecuteScript(){if(this.KMD_SCRIPT in this.KMD_LOCK)return;this.KMD_LOCK.push(this.KMD_SCRIPT);let t=Function(this.KMD_SCRIPT),e=new function t(){this.prototype=Window.prototype};t.bind(e)()}AddHook(t,e,o){this.KMD_HOOKS.push(Object.freeze({type:t,target:e,injection:o}))}PatchScript(){fetch(this.KMD_SCRIPT_URL).then(t=>t.text()).then((function(t){this.KMD_HOOKS.forEach(function(e){let o=KMD_INSTANCES[e.type].processor;t=o(t,e.target,e.injection)}),this.KMD_SCRIPT=t,this.ExecuteScript()}).bind(this))}constructor(){console.log(KMD_INSTANCES)}};const TEXT_HOOK=new KMDHook("TEXT_HOOK",function t(e,o,n){return e.replaceAll(o,n)}),PROP_HOOK=new KMDHook("PROP_HOOK",function t(e,o,n){delete Object.prototype[o],Object.defineProperty(Object.prototype,o,{get:n,set:t=>t})}),SET_HOOK=new KMDHook("SET_HOOK",function t(e,o,n){Object.defineProperty(Object.prototype,o,{value:n})}),GLOBAL_HOOK=new KMDHook("GLOBAL_HOOK",function t(e,o,n){delete Object.prototype[o],Object.defineProperty(Object.prototype,o,{value:n,writable:!1})}),HTML_HOOK=new KMDHook("HTML_HOOK",async function t(e,o){let n=await fetch(location.href),r=await n.text(),i=r;for(let K of o){let p=K,c=p[K];i=i.replaceAll(p,c)}return document.write(i),e}),PROP_REMOVE=new KMDHook("PROP_REMOVE",function t(e,o,n){return delete Object.prototype[o],e}),DEFEND_HOOK=new KMDHook("DEFEND_HOOK",function t(e,o,n){return Object.hasOwnPropertyDescriptor=new Proxy(Object.hasOwnPropertyDescriptor,{apply:(t,e,o)=>Object.freeze({})}),e}),DEFEND_STACK=new KMDApi("DEFEND_STACK",function t(e,o,n){let r=Error().stack;return Error=new Proxy(Error,{construct(t,e){let o=new t(e),n=r.split(".js")[0].split(" ");return o.stack=o.replaceAll(n[n.length-1],"*.js"),o}}),e});
